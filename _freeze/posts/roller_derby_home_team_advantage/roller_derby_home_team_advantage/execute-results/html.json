{
  "hash": "86630fcff4d5daf7729ddc241e0585e2",
  "result": {
    "markdown": "---\ntitle: \"Roller Derby Home Team Advantage\"\ndate: \"2023-03-13\"\ndescription: \"\"\nimage: \".jpg\"\nexecute: \n   warning: false\n   message: false\nfilters:\n   - lightbox\nlightbox: auto\nformat:\n  html:\n    code-fold: true\ndraft: true\n---\n\n\n\n\n## Introduction\n\nHome team advantage is the tendency for sports teams to win more often when they are the home rather than the visiting team.\n\nIn their 2014 article [New Insights Involving the Home Team Advantage](https://www.sfu.ca/~tswartz/papers/hca.pdf), Tim B. Swartz and Adriano Arce investigated home team advantage in the NHL and NBA. Using [FlatTrackStats](http://flattrackstats.com/)' [dataset](https://www.kaggle.com/datasets/thefringthing/flat-track-roller-derby-dataset), we can trace their methodology to learn about home team advantage in women's flat track roller derby.\n\n## Preparing the Data\n\nIn tournaments, \"home\" and \"visitor\" are assigned arbitrarily, so we'll filter out tournament bouts. Let's also add columns for the home margin (the difference between the home team's score and the visitors' score) and an indicator for whether the home team won.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nread_csv(\"flattrackstats_bouts_2022-03-26.csv.zip\") |>\n  filter(is.na(tournamentID)) |>\n  drop_na(homeScore, visitorScore) |>\n  mutate(home_margin = homeScore - visitorScore,\n         home_victory = homeScore > visitorScore) ->\n  bouts\n\nbouts |>\n  sample_n(15) |>\n  kbl()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> id </th>\n   <th style=\"text-align:left;\"> date </th>\n   <th style=\"text-align:left;\"> time </th>\n   <th style=\"text-align:right;\"> tournamentID </th>\n   <th style=\"text-align:right;\"> homeTeamID </th>\n   <th style=\"text-align:right;\"> homeScore </th>\n   <th style=\"text-align:right;\"> visitorTeamID </th>\n   <th style=\"text-align:right;\"> visitorScore </th>\n   <th style=\"text-align:right;\"> home_margin </th>\n   <th style=\"text-align:left;\"> home_victory </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 89968 </td>\n   <td style=\"text-align:left;\"> 2017-02-11 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 4807 </td>\n   <td style=\"text-align:right;\"> 249 </td>\n   <td style=\"text-align:right;\"> 7747 </td>\n   <td style=\"text-align:right;\"> 118 </td>\n   <td style=\"text-align:right;\"> 131 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50487 </td>\n   <td style=\"text-align:left;\"> 2014-05-04 </td>\n   <td style=\"text-align:left;\"> 18:00:00 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 17793 </td>\n   <td style=\"text-align:right;\"> 84 </td>\n   <td style=\"text-align:right;\"> 24097 </td>\n   <td style=\"text-align:right;\"> 158 </td>\n   <td style=\"text-align:right;\"> -74 </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 23235 </td>\n   <td style=\"text-align:left;\"> 2012-09-15 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 9544 </td>\n   <td style=\"text-align:right;\"> 142 </td>\n   <td style=\"text-align:right;\"> 9543 </td>\n   <td style=\"text-align:right;\"> 116 </td>\n   <td style=\"text-align:right;\"> 26 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 89701 </td>\n   <td style=\"text-align:left;\"> 2017-04-08 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 8137 </td>\n   <td style=\"text-align:right;\"> 118 </td>\n   <td style=\"text-align:right;\"> 26479 </td>\n   <td style=\"text-align:right;\"> 188 </td>\n   <td style=\"text-align:right;\"> -70 </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 65032 </td>\n   <td style=\"text-align:left;\"> 2014-07-19 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 45436 </td>\n   <td style=\"text-align:right;\"> 200 </td>\n   <td style=\"text-align:right;\"> 36769 </td>\n   <td style=\"text-align:right;\"> 133 </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 16354 </td>\n   <td style=\"text-align:left;\"> 2008-09-13 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 3639 </td>\n   <td style=\"text-align:right;\"> 132 </td>\n   <td style=\"text-align:right;\"> 8044 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 69 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 44338 </td>\n   <td style=\"text-align:left;\"> 2014-08-30 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 6696 </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 30425 </td>\n   <td style=\"text-align:right;\"> 166 </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 94961 </td>\n   <td style=\"text-align:left;\"> 2017-03-25 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 14233 </td>\n   <td style=\"text-align:right;\"> 175 </td>\n   <td style=\"text-align:right;\"> 11255 </td>\n   <td style=\"text-align:right;\"> 143 </td>\n   <td style=\"text-align:right;\"> 32 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 11385 </td>\n   <td style=\"text-align:left;\"> 2012-08-18 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 3407 </td>\n   <td style=\"text-align:right;\"> 144 </td>\n   <td style=\"text-align:right;\"> 3438 </td>\n   <td style=\"text-align:right;\"> 147 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 46630 </td>\n   <td style=\"text-align:left;\"> 2014-03-08 </td>\n   <td style=\"text-align:left;\"> 18:00:00 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 20989 </td>\n   <td style=\"text-align:right;\"> 158 </td>\n   <td style=\"text-align:right;\"> 3406 </td>\n   <td style=\"text-align:right;\"> 136 </td>\n   <td style=\"text-align:right;\"> 22 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 92680 </td>\n   <td style=\"text-align:left;\"> 2017-04-22 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 33444 </td>\n   <td style=\"text-align:right;\"> 191 </td>\n   <td style=\"text-align:right;\"> 19169 </td>\n   <td style=\"text-align:right;\"> 138 </td>\n   <td style=\"text-align:right;\"> 53 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 95948 </td>\n   <td style=\"text-align:left;\"> 2017-04-29 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 7601 </td>\n   <td style=\"text-align:right;\"> 217 </td>\n   <td style=\"text-align:right;\"> 18984 </td>\n   <td style=\"text-align:right;\"> 244 </td>\n   <td style=\"text-align:right;\"> -27 </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 69080 </td>\n   <td style=\"text-align:left;\"> 2015-05-30 </td>\n   <td style=\"text-align:left;\"> 17:00:00 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 32003 </td>\n   <td style=\"text-align:right;\"> 305 </td>\n   <td style=\"text-align:right;\"> 19374 </td>\n   <td style=\"text-align:right;\"> 175 </td>\n   <td style=\"text-align:right;\"> 130 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 16034 </td>\n   <td style=\"text-align:left;\"> 2012-06-23 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 8091 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:right;\"> 3470 </td>\n   <td style=\"text-align:right;\"> 274 </td>\n   <td style=\"text-align:right;\"> -240 </td>\n   <td style=\"text-align:left;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 28473 </td>\n   <td style=\"text-align:left;\"> 2013-03-09 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 21164 </td>\n   <td style=\"text-align:right;\"> 155 </td>\n   <td style=\"text-align:right;\"> 24523 </td>\n   <td style=\"text-align:right;\"> 90 </td>\n   <td style=\"text-align:right;\"> 65 </td>\n   <td style=\"text-align:left;\"> TRUE </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Scores\n\nFirst we can look at the empirical distribution of scores, both in general and by venue.\n\n::: panel-tabset\n\n### Scores\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |>\n  pivot_longer(cols = c(homeScore, visitorScore), \n               names_to = \"venue\",\n               values_to = \"score\") |>\n  ggplot(aes(x = score)) +\n  geom_histogram(binwidth = 1) + \n  scale_x_continuous(limits = c(0, 600), n.breaks = 20) +\n  stat_summary(fun = \"mean\", \n               geom = \"vline\", \n               linewidth = 1.25, \n               aes(x = 0, y = score, xintercept = stat(y))) +\n  labs(title = \"Distribution of Scores\", \n       x = \"Score\", \n       y = \"Count\", \n       caption = \"Vertical line indicates the mean.\")\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Scores by Venue\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |>\n  pivot_longer(cols = c(homeScore, visitorScore), \n               names_to = \"venue\",\n               values_to = \"score\") |>\n  select(score, venue) |>\n  mutate(venue = recode(venue, homeScore = \"Home\", visitorScore = \"Visitor\")) |>\n  ggplot(aes(x = score, fill = venue)) +\n  geom_histogram(position = \"identity\", alpha = 0.5, binwidth = 1) +\n  scale_x_continuous(limits = c(0, 600), n.breaks = 20) +\n  stat_summary(fun = \"mean\", \n               geom = \"vline\", \n               linewidth = 1.25,\n               aes(x = 0, \n                   y = score, \n                   color = venue, \n                   group = venue, \n                   xintercept = stat(y))) +\n    labs(title = \"Distribution of Scores by Venue\",\n       x = \"Score\",\n       y = \"Count\",\n       fill = \"Venue\",\n       color = \"Venue\",\n       caption = \"Vertical lines indicate group means.\")\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Total Score\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |>\n  ggplot(aes(x = homeScore + visitorScore)) +\n  geom_histogram(binwidth = 1) +\n  scale_x_continuous(limits = c(0, 600), n.breaks = 20) +\n  labs(title = \"Distribution of Total Scores\",\n       x = \"Total Score\",\n       y = \"Count\",\n       caption = \"Vertical line indicates the mean.\") +\n  stat_summary(fun = \"mean\", \n               geom = \"vline\",\n               linewidth = 1.25,\n               aes(x = 0, y = homeScore + visitorScore, xintercept = stat(y)))\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n:::\n\n\n\n\n\nThe sample mean score is about 157 points. When we condition by venue (i.e. home vs away), the means are 169 and 146, for a difference of 23 points. It's clear that the home team achieves a higher score on average.\n\n## Home Margin\n\nRather than settle for an average difference^[Expectation is linear, so the difference of averages is the average difference.], let's see the whole distribution of differences^[The properties of this distribution might contribute to a good measure of how prone a given sports league is to lopsided \"blowouts\".]:\n\n### Distribution of Home Margin\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |> \n  ggplot(aes(x = home_margin)) +\n  geom_histogram(binwidth = 1) +\n  scale_x_continuous(limits = c(-500, 500)) +\n  geom_vline(xintercept = 0, colour = \"white\", linetype = \"dotted\") +\n  stat_summary(fun = \"mean\", \n               geom = \"vline\", \n               linewidth = 1.25,\n               aes(x = 0, y = home_margin, xintercept = stat(y))) +\n  labs(title = \"Distribution of Home Margin\", x = \"Home Margin\", y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n## Winning Proportion\n\nWhat proportion of bouts are won by the home team? \n\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |> pull(home_victory) |> mean()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6000989\n```\n:::\n:::\n\n\nSo the home team wins about 60.0098931% of bouts and scores 24 more points than the visitors on average.\n\n## Trends by Year\n\nOur data include dates, so we can see how these quantities have been changing over time.\n\n::: panel-tabset\n### Total Score\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |>\n  group_by(year = floor_date(date, unit = \"year\")) |>\n  summarize(tpt = mean(homeScore + visitorScore)) |>\n  ggplot(aes(x = year, y = tpt)) +\n  geom_point() +\n  geom_line() +\n  geom_smooth(method = \"lm\") +\n  labs(title= \"Total Score by Year\", y = \"Average Total Points\", x = \"Year\")\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### Home Margin\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |>\n  group_by(year = floor_date(date, unit = \"year\")) |>\n  summarize(hta = mean(home_margin)) |>\n  ggplot(aes(x = year, y = hta)) +\n  geom_point() +\n  geom_line() +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Average Home Margin by Year\", \n       y = \"Average Home Margin\", \n       x = \"Year\")\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Winning Proportion\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |>\n  group_by(year = floor_date(date, unit = \"year\")) |>\n  summarize(win = sum(home_victory)/n()) |>\n  ggplot(aes(x = year, y = win)) +\n  geom_point() +\n  geom_line() +\n  geom_smooth(method = \"lm\") +\n  labs(title = \"Home Win Rate by Year\", y = \"Home Win Rate\", x = \"Year\")\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n:::\n\nThe average total score and home margin seem to be increasing over time, but there's no clear trend in proportion of home team victories.\n\n## Home Margin, Total Points\n\nSwartz and Arce regress average home margin on average total score, so let's do that:\n\n::: panel-tabset\n### Home Margin by Total Points\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |>\n  group_by(year = floor_date(date, unit = \"year\")) |>\n  summarize(hta = mean(home_margin),\n            tpt = mean(homeScore + visitorScore)) |>\n  ggplot(aes(x = tpt, y = hta)) +\n  geom_point() +\n  geom_text(hjust = -0.5, size = 2.5, aes(label = year(year))) +\n  stat_poly_line() +\n  stat_poly_eq() +\n  labs(title = \"Average Home Margin by Average Total Score\", \n       x = \"Average Total Score\", \n       y = \"Average Home Margin\")\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### HTA ~ TPT\n\n::: {.cell}\n\n```{.r .cell-code}\nbouts |>\n  group_by(year = floor_date(date, unit = \"year\")) |>\n  summarize(hta = mean(home_margin),\n            tpt = mean(homeScore + visitorScore)) |>\n  lm(hta ~ tpt, data = _) |>\n  ggplot(aes(x = .fitted, y = .resid)) +\n  geom_point() +\n  geom_smooth(method = \"lm\") +\n    labs(y = \"Standardized Residuals\", x = \"Predicted HTA\")\n```\n\n::: {.cell-output-display}\n![](roller_derby_home_team_advantage_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n:::\n\nAlthough it seems plausible that average home margins and total scores would be linearly related, for our data the regression yields rather poor results. In particular, our residuals don't look very random. A quadratic regression might address that specific worry, but the fit wouldn't be any better relative to the added complexity of the model.^[R_adj^2 = 0.54.]\n\n## Team Effects\n\n(Explanation about why the data suck too much to do this part.)\n\n## References\n\n-   [New Insights Involving the Home Team Advantage (Swartz & Arce, 2014)](https://www.sfu.ca/~tswartz/papers/hca.pdf)",
    "supporting": [
      "roller_derby_home_team_advantage_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}