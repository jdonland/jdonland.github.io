{
  "hash": "de34ac08cb071980d137b0f338d7d879",
  "result": {
    "markdown": "---\ntitle: \"\"\ndate: \"2024-06-06\"\ndate-modified: now\ndate-format: long\nimage: violin_plot_thumbnail.png\ndescription: \"Recreating a YouGov Data Graphic with ggplot2\"\nfilters:\n   - lightbox\nlightbox: auto\ncode-fold: true\nformat:\n  html:\n    fig-width: 8.9\n    fig-height: 7.67\ndraft: true\n---\n\n\n\n\n## Introduction\n\nYouGov published this data graphic showing which country people in Great Britain, the United States, France, and Germany today believe most contributed to Germany's defeat in the Second World War, compared to the answers given by the French at end of the war.\n\n![Original](original.png)\n\nLet's use `ggplot2` to recreate it as closely as possible.\n\n## Data\n\nWe can read off the data from the original graphic and store it in \"long\" format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\"year,country,combatant,value\n2024,Great Britain,United States,20\n2024,Great Britain,Soviet Union,15\n2024,Great Britain,United Kingdom,39\n2024,Great Britain,Another country,1\n2024,Great Britain,Don't know,25\n2024,United States,United States,59\n2024,United States,Soviet Union,13\n2024,United States,United Kingdom,6\n2024,United States,Another country,1\n2024,United States,Don't know,21\n2024,France,United States,47\n2024,France,Soviet Union,17\n2024,France,United Kingdom,10\n2024,France,Another country,2\n2024,France,Don't know,24\n2024,Germany,United States,34\n2024,Germany,Soviet Union,31\n2024,Germany,United Kingdom,6\n2024,Germany,Another country,3\n2024,Germany,Don't know,27\n1945,France,United States,20\n1945,France,Soviet Union,57\n1945,France,United Kingdom,12\n1945,France,The three equally,2\n1945,France,Another country/Don't know,9\" |>\n  read_csv(col_types = \"fffn\") ->\n  yougov_data\n```\n:::\n\n\n## Building the Plot\n\n### Basic Structure\n\nThe basic structure of YouGov's graphic is a horizontal bar chart faceted by the year of the poll and the nationality of the respondants.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyougov_data |>\n  mutate(combatant = fct_rev(combatant)) |>\n  ggplot(aes(x = value, y = combatant)) +\n  geom_col() +\n  facet_grid(rows = vars(year), cols = vars(country), scales = \"free_y\")\n```\n\n::: {.cell-output-display}\n![](yougov_ww2_poll_files/figure-html/unnamed-chunk-3-1.png){width=854.4}\n:::\n:::\n\n### Text Part One\n\nNext we'll add the title, subtitle, and caption, and adjust the facet labels.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntitle <- \"Britons tend to think that the UK did the most to defeat the Nazis - other countries aren't so sure\"\nsubtitle <- \"In your opinion, which country would you say contributed most to the defeat of Germany in World War Two? (%)\"\n\nyougov_data |>\n  mutate(combatant = fct_rev(combatant)) |>\n  ggplot(aes(x = value, y = combatant)) +\n  geom_col() +\n  facet_grid(rows = vars(year), \n             cols = vars(country),\n             scales = \"free_y\",\n             switch = \"y\",\n             labeller = labeller(country = \\(x) paste0(\"According to people in \", x),\n                                 year = \\(x) paste0(\"Asked in May \", x, ifelse(x == \"2024\", \"\\n(YouGov)\", \"\\n(IFOP)\")))) +\n  labs(title = title, subtitle = subtitle)\n```\n\n::: {.cell-output-display}\n![](yougov_ww2_poll_files/figure-html/unnamed-chunk-4-1.png){width=854.4}\n:::\n:::\n\n\n### Colours\n\nLet's apply YouGov's colour scheme to the bars using `scale_fill_manual()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyougov_data |>\n  mutate(combatant = fct_rev(combatant)) |>\n  ggplot(aes(x = value, y = combatant, fill = country)) +\n  geom_col() +\n  scale_fill_manual(values = c(\"#FF412D\", \"#06A7EE\", \"#003CAC\", \"#2A2D35\")) +\n  facet_grid(rows = vars(year), \n             cols = vars(country),\n             scales = \"free_y\",\n             switch = \"y\",\n             labeller = labeller(country = \\(x) paste0(\"According to people in \", x),\n                                 year = \\(x) paste0(\"Asked in May \", x, ifelse(x == \"2024\", \"\\n(YouGov)\", \"\\n(IFOP)\")))) +\n  labs(title = title, subtitle = subtitle)\n```\n\n::: {.cell-output-display}\n![](yougov_ww2_poll_files/figure-html/unnamed-chunk-5-1.png){width=854.4}\n:::\n:::\n\n\n### Theme\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlabeller(\n  country = \\(x) paste0(\"According to<br>people in \", \n                        ifelse(x == \"United States\", \"the<br>\", \"\"), \n                        ifelse(x == \"Great Britain\", \"Great<br>Britain\", x)),\n  year = \\(x) paste0(\"Asked in May \", \n                     x, \n                     ifelse(x == \"2024\", \"\\n(YouGov)\", \"\\n(IFOP)\"))) ->\n  country_labeller\n\nyougov_data |>\n  mutate(combatant = fct_rev(combatant)) |>\n  mutate(\n    .by = year, \n    line_position = as.numeric(factor(combatant, \n                                      levels = unique(combatant))) + 0.5,\n    line_position = ifelse(line_position == max(line_position), \n                           NA, \n                           line_position)) |>\n  mutate(\n    combatant = case_when(\n      year == 2024 ~ paste0(combatant, str_dup(\" \", 16)),\n      TRUE ~ combatant)) |>\n  ggplot(aes(x = value, y = combatant, fill = country, label = value)) +\n  geom_col() +\n  geom_text(\n    aes(x = ifelse(value > 14, 0, value),\n    colour = ifelse(value > 14, \"1\", \"2\")),\n    hjust = 0,\n    nudge_x = 3,\n    nudge_y = 0.05, \n    size = 4) +\n  geom_hline(\n    aes(yintercept = line_position), \n    color = \"white\", \n    linewidth = 1.8) +\n  scale_x_continuous(expand = expansion(0, 0)) + \n  scale_y_discrete(expand = expansion(0, 0)) +\n  scale_fill_manual(values = c(\"#FF412D\", \"#06A7EE\", \"#003CAC\", \"#2A2D35\")) +\n  scale_colour_manual(values = c(\"#FFFFFF\", \"#000000\")) +\n  facet_grid(\n    rows = vars(year), \n    cols = vars(country),\n    scales = \"free_y\",\n    drop = TRUE,\n    switch = \"y\",\n    labeller = country_labeller) +\n\n  labs(title = title, subtitle = subtitle) +\n  theme(\n    legend.position = \"none\",\n    plot.title.position = \"plot\",\n    plot.title = element_textbox_simple(\n      size = 18, \n      face = \"bold\", \n      padding = margin(1, 1, 12, 1)),\n    plot.subtitle = element_textbox_simple(padding = margin(1, 1, 20, 1)),\n    axis.title = element_blank(),\n    axis.text.x = element_blank(),\n    axis.text.y = element_text(hjust = 0, size = 10),\n    axis.ticks = element_blank(),\n    strip.placement = \"outside\",\n    strip.background = element_blank(),\n    strip.text = element_textbox_simple(\n      width = unit(1.41, \"in\"),\n      height = unit(0.54, \"in\"),\n      hjust = 0,\n      size = 10,\n      padding = margin(1, 1, 20, 1)),\n    strip.text.y = element_text(face = \"bold\"),\n    panel.background = element_rect(fill = \"#F6F6F6\"),\n    panel.grid = element_blank(),\n    panel.spacing.y = unit(0.5, \"in\"))\n```\n\n::: {.cell-output-display}\n![](yougov_ww2_poll_files/figure-html/unnamed-chunk-6-1.png){width=854.4}\n:::\n:::",
    "supporting": [
      "yougov_ww2_poll_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}